#include <iostream>
#include <windows.h>
#include <string>
#include <vector>

using namespace std;


void FiveTask1() {
    int length = 0, num, maximum;

    do {
        cout << "Введите длину для массива: ";
        cin >> length;
        if (length <= 0) {
            cout << "Число слишком маленькое! Повторите свой ввод!\n";
        }
    } while (length <= 0);

    vector<int> vectorArray;
    for (int i = 0; i < length; i++) {
        cout << i+1 << " число: ";
        cin >> num;
        // Добавление числа
        vectorArray.push_back(num);
    }
    maximum = vectorArray[0];
    for (int i = 1; i < length; i++) {
        if (maximum < vectorArray[i]) {
            maximum = vectorArray[i];
        }
    }
    cout << "Максимальное число: " << maximum << endl;

}

int get_index(vector<string> array, string value) {

    int index = 0;
    for (int i = 0; i < array.size(); i++) {
        index = i;
        if (value < array[i]) {

            break;
        }
        else {
            index = i + 1;
        }
    }

    return index;
}

void FiveTask2() {
    vector<string> arrs;
    int length;
    string str;
    cout << "Введите количество строк: ";
    cin >> length;
    for (int i = 0; i < length; i++) {
        cout << "Введите строку " << i + 1 << ": ";
        cin >> str;
        if (arrs.size() == 0) {
            arrs.push_back(str);
        }
        else {
            // получаем индекс для insert
            auto iterator_to_insert = arrs.cbegin();
            arrs.insert(iterator_to_insert + get_index(arrs, str), str);
        }
    }
    for (int i = 0; i < length; i++) {
        cout << i + 1 << "\t" << arrs[i] << endl;
    }
}

void FiveTask3() {
    int num, length=0, maximum;
    do {
        cout << "Введите длину для массива: ";
        cin >> length;
        if (length <= 0) {
            cout << "Число слишком маленькое! Повторите свой ввод!\n";
        }
    } while (length <= 0);

    // Динамическое выделение
    int* array = new int[length];

    // Ukazatel'
    int* ptrNum = array;
    for (int i = 0; i < length; i++) {
        cout << i+1<< " число: ";
        cin >> num;

        // Dobavlenie
        *ptrNum = num;
        ptrNum++;
    }

    // Opyat' v nachalo
    ptrNum = array;
    maximum = *ptrNum;
    ptrNum++;
    for (int i = 1; i < length; i++) {
        cout << i + 1 << "\t" << *ptrNum << "\tMax:\t" << maximum << endl;
        if (maximum < *ptrNum) {
            maximum = *ptrNum;
        }
        ptrNum++;
    }

    cout << "Максимальное число: " << maximum << endl;

    delete[] array;
}


double rowCalculatingFunction(double** copiedMatrixArg, int matrixLengthArg, int currRow, double startDetCount) {
    cout << "\n--------------------------------------\n";
    // Вывод матрицы
    for (int i = 0; i < matrixLengthArg; i++) {
        for (int j = 0; j < matrixLengthArg; j++) {
            cout << copiedMatrixArg[i][j] << "\t";
        }
        cout << endl;
    }

    // Матрица пройдена
    if (currRow == matrixLengthArg) {
        return startDetCount;
    }

    // Ведущий эеоемент строки
    int rowWithMainElement = -1;
    for (int k = currRow; k < matrixLengthArg; k++) {
        if (abs(copiedMatrixArg[k][currRow]) > 1e-12) {
            // Если ошибка при округлении числа
            rowWithMainElement = k;
            break;
        }
    }

    // Последний элемент 0, значит строка нулевая ( типо мы прошли всю строку и не нашли не нулевой элемент)
    if (rowWithMainElement == -1) {
        return 0.0;
    }

    double newDet = startDetCount;
    if (rowWithMainElement != currRow) {
        for (int j = 0; j < matrixLengthArg; j++) {
            // Изменение прорядка строк
            swap(copiedMatrixArg[currRow][j], copiedMatrixArg[rowWithMainElement][j]);
        }
        // Изменение знака определителя
        newDet = -newDet;
    }

    // Домножение определителя на элемент главной диагонали
    newDet *= copiedMatrixArg[currRow][currRow];

    // Фикс ошибки калькулирования в исполнении С++ (мафынка не может нолик получить плак-плак)
    if (abs(copiedMatrixArg[currRow][currRow]) <= 1e-12) {
        return 0.0;
    }

    // Диагональное обнуление цифр
    for (int k = currRow + 1; k < matrixLengthArg; k++) {
        // множитель для зануления элемента
        double countToMakeNullElement = copiedMatrixArg[k][currRow] / copiedMatrixArg[currRow][currRow];
        for (int j = currRow; j < matrixLengthArg; j++) {
            copiedMatrixArg[k][j] -= countToMakeNullElement * copiedMatrixArg[currRow][j];
        }
    }
    return rowCalculatingFunction(copiedMatrixArg, matrixLengthArg, currRow + 1, newDet);
}

double matrixToTriangle(double** squareMatrix, int matrixLength) {

    // Копия матрицы
    double** copiedMatrix = new double* [matrixLength];
    for (int i = 0; i < matrixLength; i++) {
        copiedMatrix[i] = new double[matrixLength];
        for (int j = 0; j < matrixLength; j++) {
            copiedMatrix[i][j] = squareMatrix[i][j];
        }
    }

    double result = rowCalculatingFunction(
        copiedMatrix,
        matrixLength,
        0, // currRow
        1.0); // startDetCount

    for (int i = 0; i < matrixLength; ++i) {
        delete[] copiedMatrix[i];
    }
    delete[] copiedMatrix;

    return result;
}

void FiveTask4() {
    int length = 0;
    do {
        cout << "Введите длину для Размерность квадратной матрицы: ";
        cin >> length;
        if (length <= 0) {
            cout << "Число слишком маленькое! Повторите свой ввод!\n";
        }
    } while (length <= 0);

    double** matrix = new double* [length];
    for (int i = 0; i < length; i++) {
        matrix[i] = new double[length];
        for (int j = 0; j < length; j++) {
            cout << "Введите элемент " << j + 1 << " строки " << i + 1 << ": ";
            cin >> matrix[i][j];
        }
    }

    double det = matrixToTriangle(matrix, length);
    cout << "Определитель матрицы " << length << "x" << length <<" = "<< det << endl;  // Выводим результат

    for (int i = 0; i < length; ++i) {
        delete[] matrix[i];
    }
    delete[] matrix;
}

int main()
{

    SetConsoleCP(1251);
    SetConsoleOutputCP(1251);


    // 1 Задание
    // FiveTask1();

    // 2 Задание
    // FiveTask2();

    // 3 Задание
    // FiveTask3();

    // 4 Задание
    FiveTask4();

    return 0;
}
